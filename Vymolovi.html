<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Výmolovi</title>

    <link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/resp.css">
    
    <style>
    /* Import fontu EB Garamond */
    @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap');
   
        body {
            font-family: 'EB Garamond', serif;
            background-color: #ebd9c6;
            color: #4a331c;
            margin: 0;
            overflow-y: auto; 
            overflow-x: hidden; 
        }

        .page-wrapper {
            width: 100%;
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            box-sizing: border-box; 
            text-align: center; 
        }

        .page-wrapper h1 {
            font-family: "Dancing Script";
            font-size: 32px;
            color: #5C4033; 
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .page-wrapper .instructions {
            font-size: 16px;
            color: #555;
            margin-bottom: 20px;
        }
        
        .chart-container {
            width: 100%;
            max-width: 1200px;
        }

        svg {
            width: 100%;
            height: auto;
            font-size: 10px;
        }

        /* ----- Styly pro buňky rodokmenu ----- */
        .ancestor-cell {
            fill: #ffffff;
            stroke: #a8763e;
            stroke-width: 1;
            transition: fill 0.2s ease-in-out;
        }
        
        .ancestor-group {
             cursor: pointer;
        }

        .ancestor-group:hover .ancestor-cell {
            fill: #704d29;
        }

        .ancestor-text {
            fill: #5d4222;
            /* text-anchor se nyní nastavuje v JS */
            dominant-baseline: middle;
            pointer-events: none;
            font-size: 20px;
            font-weight: 500;
        }
   
        /* Barevné odlišení generací *//* https://www.w3schools.com/colors/colors_picker.asp */
        .gen-1 .ancestor-cell { fill: #f2e6d9; }
        .gen-2 .ancestor-cell { fill: #ebd9c6; }
        .gen-3 .ancestor-cell { fill: #e4cdb4; }
        .gen-4 .ancestor-cell { fill: #ddc0a1; }
        .gen-5 .ancestor-cell { fill: #d6b48f; }
        .gen-6 .ancestor-cell { fill: #cfa77d; }
        
        .ancestor-group:hover .ancestor-cell {
            fill: #815931;
        }
        .ancestor-group:hover .ancestor-text {
            fill: white;
            font-weight: bold;
        }
        
        /* ----- Styly pro modální okno (beze změny) ----- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5); 
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex; 
        }

        .modal-content {
            background-color: #f8f2ec;
            margin: auto;
            padding: 25px;
            border: 1px solid #956637;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .modal-close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .modal-content h2 {
            margin-top: 0;
            color: #5C4033; 
        }
        
        .modal-content p {
            line-height: 1.6;
            font-size: 20px;
            display: none; 
        }
        
        .modal-content p strong {
            display: inline-block;
            min-width: 80px; 
            color: #555;
        }
        
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 10px; 
        }
        
        .modal-button {
            display: inline-block; 
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            color: #fff;
            background-color: #815931; 
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .modal-button:hover {
            background-color: #cfa77d; 
        }
        
        .modal-button.disabled {
            background-color: #ccc;
            cursor: not-allowed;
            pointer-events: none;
        }

    </style>
</head>
<body>
<section>
	
    <div class="page-wrapper">
        <h1>Předkové rodu Výmolových </h1>
        <p class="instructions">Kliknutím na pole se jménem zobrazíte detailní informace o osobě.</p>

        <div class="chart-container">
            <svg id="fan-chart" viewBox="0 0 1000 520"></svg>
        </div>

		<div><a href="index.html">Zpět na rozcestník rodů </a></div>
		<footer>Vytvořila Karolína </footer>
    </div>
</section>
	
    <div id="person-modal" class="modal">
        <div class="modal-content">
            <span id="modal-close-btn" class="modal-close">&times;</span>
            
            <h2 id="modal-name">Jméno osoby</h2>
            
            <p id="modal-row-birth"><strong class.text-gray-500>Narození:</strong> <span id="modal-birth"></span></p>
            <p id="modal-row-marriage"><strong class.text-gray-500>Sňatek:</strong> <span id="modal-marriage"></span></p>
            <p id="modal-row-death"><strong class.text-gray-500>Úmrtí:</strong> <span id="modal-death"></span></p>
            <p id="modal-row-cause"><strong class.text-gray-500>Příčina úmrtí:</strong> <span id="modal-cause"></span></p>
            <p id="modal-row-occupation"><strong class.text-gray-500>Povolání:</strong> <span id="modal-occupation"></span></p>
            <p id="modal-row-note"><strong class.text-gray-500>Poznámka:</strong> <span id="modal-note"></span></p>

            <div class="modal-buttons">
                <a id="modal-link-birth" href="#" target="_blank" class="modal-button">Matrika narození</a>
                <a id="modal-link-marriage" href="#" target="_blank" class="modal-button">Matrika sňatků</a>
                <a id="modal-link-death" href="#" target="_blank" class="modal-button">Matrika úmrtí</a>
            </div>
        </div>
    </div>
    

    <script>
        (function() {
            // --- Nastavení ---
            const generations = 6;
            const centerX = 500; 
            const centerY = 20;  
            const radii = [0, 80, 160, 240, 320, 400, 480]; 
            const svg = document.getElementById('fan-chart');

            // --- Vzorová DATA (beze změny) ---
            const ancestorData = {
                '1_0': {
                    name: 'Zdeněk Výmola',
                    birth: '15. 2. 1943, Čejč',
                    death: '16. 4. 2024, Zlín', 
                    cause: null, 
                    occupation: '',
                    marriage: null, 
                    linkBirth: '',
                    linkMarriage: null, 
                    linkDeath: null     
                }
                    
            
            };
            
            // Popisky (jména) pro buňky
            const labels = {};
            for (const key in ancestorData) {
                if(ancestorData[key]) labels[key] = ancestorData[key].name;
            }
            
            // --- Reference na modální okno a jeho prvky (beze změny) ---
            const modal = document.getElementById('person-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalName = document.getElementById('modal-name');
            
            const modalBirth = document.getElementById('modal-birth');
            const modalMarriage = document.getElementById('modal-marriage');
            const modalDeath = document.getElementById('modal-death');
            const modalCause = document.getElementById('modal-cause');
            const modalOccupation = document.getElementById('modal-occupation');
            const modalNote = document.getElementById('modal-note');
            
            const modalLinkBirth = document.getElementById('modal-link-birth');
            const modalLinkMarriage = document.getElementById('modal-link-marriage');
            const modalLinkDeath = document.getElementById('modal-link-death');

            // --- Formátování data do češtiny (beze změny) ---
            const czechMonths = [
                'ledna', 'února', 'března', 'dubna', 'května', 'června',
                'července', 'srpna', 'září', 'října', 'listopadu', 'prosince'
            ];

            function formatCzechDate(dateString) {
                if (!dateString) {
                    return null;
                }
                const match = dateString.match(/^(\d{1,2})\. *(\d{1,2})\. *(\d{4})(.*)$/);

                if (match) {
                    const day = match[1];
                    const monthIndex = parseInt(match[2], 10) - 1; 
                    const year = match[3];
                    const rest = match[4]; 

                    if (monthIndex >= 0 && monthIndex < 12) {
                        const monthName = czechMonths[monthIndex];
                        return `${day}. ${monthName} ${year}${rest}`;
                    }
                }
                return dateString;
            }

            // --- Funkce modálního okna (beze změny) ---
            function updateModalRow(spanElement, value) {
                const rowElement = spanElement.parentElement; 
                if (value) {
                    spanElement.textContent = value;
                    rowElement.style.display = 'block'; 
                } else {
                    spanElement.textContent = ''; 
                    rowElement.style.display = 'none';  
                }
            }

            function closeModal() {
                modal.classList.remove('active');
            }
            modalCloseBtn.onclick = closeModal;
            modal.onclick = function(event) {
                if (event.target == modal) {
                    closeModal();
                }
            }
            
            function showModal(key) {
                const data = ancestorData[key];
                
                if (data) {
                    modalName.textContent = data.name;
                    updateModalRow(modalBirth, formatCzechDate(data.birth));
                    updateModalRow(modalMarriage, formatCzechDate(data.marriage));
                    updateModalRow(modalDeath, formatCzechDate(data.death));
                    updateModalRow(modalCause, data.cause);
                    updateModalRow(modalOccupation, data.occupation);
                    updateModalRow(modalNote, data.note); 
                    
                    setButtonLink(modalLinkBirth, data.linkBirth);
                    setButtonLink(modalLinkMarriage, data.linkMarriage);
                    setButtonLink(modalLinkDeath, data.linkDeath);

                } else {
                    modalName.textContent = `Předek (Gen ${key.split('_')[0]}, Index ${key.split('_')[1]})`;
                    updateModalRow(modalBirth, null);
                    updateModalRow(modalMarriage, null);
                    updateModalRow(modalDeath, null);
                    updateModalRow(modalCause, null);
                    updateModalRow(modalOccupation, null);
                    updateModalRow(modalNote, null);
                    
                    setButtonLink(modalLinkBirth, null);
                    setButtonLink(modalLinkMarriage, null);
                    setButtonLink(modalLinkDeath, null);
                }
                
                modal.classList.add('active'); 
            }
            
            function setButtonLink(button, href) {
                if (href && href !== '#') {
                    button.href = href;
                    button.classList.remove('disabled');
                    button.removeAttribute('aria-disabled');
                    button.style.display = 'inline-block'; 
                } else {
                    button.href = '#'; 
                    button.classList.add('disabled');
                    button.setAttribute('aria-disabled', 'true');
                    button.style.display = 'none'; 
                }
            }

            // --- Helper funkce (beze změny) ---
            function polarToCartesian(cx, cy, radius, angleInDegrees) {
                const angleInRadians = (angleInDegrees) * Math.PI / 180.0;
                return {
                    x: cx + (radius * Math.cos(angleInRadians)),
                    y: cy + (radius * Math.sin(angleInRadians))
                };
            }

            function describeArcSector(x, y, innerRadius, outerRadius, startAngle, endAngle) {
                const startOuter = polarToCartesian(x, y, outerRadius, endAngle);
                const endOuter = polarToCartesian(x, y, outerRadius, startAngle);
                const startInner = polarToCartesian(x, y, innerRadius, endAngle);
                const endInner = polarToCartesian(x, y, innerRadius, startAngle);
                const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                const d = [
                    "M", startOuter.x, startOuter.y, 
                    "A", outerRadius, outerRadius, 0, largeArcFlag, 0, endOuter.x, endOuter.y,
                    "L", endInner.x, endInner.y,     
                    "A", innerRadius, innerRadius, 0, largeArcFlag, 1, startInner.x, startInner.y,
                    "Z"
                ].join(" ");
                return d;
            }

            
                
                            // --- AKTUALIZOVANÁ FUNKCE PRO TŘÍŘÁDKOVÉ ZALAMOVÁNÍ ---
            function createTextLabel(text, gen, midAngle, midRadius) {
                const textPos = polarToCartesian(centerX, centerY, midRadius, midAngle); 
                
                const textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
                textEl.setAttribute("x", textPos.x);
                textEl.setAttribute("y", textPos.y);

                // Otáčení textu (logika zůstává beze změny)
                let textAngle = midAngle - 90; 
                if (gen === 1) {
                    textAngle = 0;
                }
                
                textEl.setAttribute("transform", `rotate(${textAngle}, ${textPos.x}, ${textPos.y})`);
                textEl.style.textAnchor = "middle"; 

                textEl.classList.add("ancestor-text");
                
                // Zmenšení písma pro vnější generace (zachováno)
                if (gen > 4) textEl.style.fontSize = "12px";
                if (gen > 5) textEl.style.fontSize = "10px";
                
                // --- NOVÁ LOGIKA TŘÍ ŘÁDKŮ ---
                const parts = text.split(/\s+/); 
                
                if (parts.length >= 3) {
                    const line1 = parts[0];             // První jméno
                    const line2 = parts[1];             // Druhé jméno
                    const line3 = parts.slice(2).join(' '); // Zbytek (Příjmení/Více příjmení)
                    
                    // --- 1. ŘÁDEK (NEJVÝŠE) ---
                    const tspan1 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                    tspan1.textContent = line1;
                    // Posun nahoru o 1 řádek, aby byl text centrován symetricky
                    tspan1.setAttribute('dy', '-1em'); 
                    tspan1.setAttribute('x', textPos.x);
                    textEl.appendChild(tspan1);

                    // --- 2. ŘÁDEK (STŘED) ---
                    const tspan2 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                    tspan2.textContent = line2;
                    // Posun dolů o 1 řádek od předchozího, čímž se vrací do středu
                    tspan2.setAttribute('dy', '1em'); 
                    tspan2.setAttribute('x', textPos.x); 
                    textEl.appendChild(tspan2);
                    
                    // --- 3. ŘÁDEK (NEJSPODNĚJI) ---
                    const tspan3 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                    tspan3.textContent = line3;
                    // Posun dolů o 1 řádek od předchozího
                    tspan3.setAttribute('dy', '1em'); 
                    tspan3.setAttribute('x', textPos.x); 
                    textEl.appendChild(tspan3);

                } else {
                    // Původní logika pro 1 nebo 2 slova (zachování 2 řádků, nebo bez zalamování)
                    
                    if (parts.length === 2) {
                        const line1 = parts[0];
                        const line2 = parts[1];
                        
                        // Nová (více symetrické centrování):
                        const tspan1 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        tspan1.textContent = line1;
                        // Posun nahoru o 0.5 řádku (centrováno uprostřed dvou řádků)
                        tspan1.setAttribute('dy', '-0.5em'); 
                        tspan1.setAttribute('x', textPos.x);
                        textEl.appendChild(tspan1);

                        const tspan2 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        tspan2.textContent = line2;
                        tspan2.setAttribute('x', textPos.x); 
                        // Posun dolů o 1 řádek od předchozího (-0.5 + 1.0 = +0.5, stále centrováno)
                        tspan2.setAttribute('dy', '1em'); 
                        textEl.appendChild(tspan2);
                    } else {
                        // Jen jedno slovo, nezalamujeme
                         textEl.textContent = text;
                    }
                }

                return textEl;
        }
                


            // --- Hlavní smyčka pro generování (beze změny) ---
            const totalAngle = 180; 
            for (let gen = 1; gen <= generations; gen++) {
                const numAncestors = Math.pow(2, gen - 1); 
                const angleSlice = totalAngle / numAncestors; 
                const innerR = radii[gen - 1];
                const outerR = radii[gen];

                for (let i = 0; i < numAncestors; i++) {
                    const startAngle = i * angleSlice;
                    const endAngle = (i + 1) * angleSlice;
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    const d = describeArcSector(centerX, centerY, innerR, outerR, startAngle, endAngle);
                    path.setAttribute("d", d);
                    path.classList.add("ancestor-cell");

                    const midAngle = startAngle + (angleSlice / 2);
                    const midRadius = innerR + (outerR - innerR) / 2;
                    
                    const labelKey = `${gen}_${i}`;
                    const textContent = labels[labelKey] || `Předek ${gen}-${i}`; 
                    const textEl = createTextLabel(textContent, gen, midAngle, midRadius);
                    
                    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                    g.classList.add(`gen-${gen}`, 'ancestor-group'); 
                    g.appendChild(path);
                    g.appendChild(textEl);
                    
                    g.addEventListener('click', function() {
                        showModal(labelKey); 
                    });
                    
                    svg.appendChild(g);
                }
            }
        })();
    </script>
</body>
</html>
    
     
